{"version":3,"sources":["../src/date-input.jsx"],"names":["separators","LEFT","UP","RIGHT","DOWN","get","day","month","year","set","noop","lastDay","date","Date","getFullYear","getMonth","getDate","DateInput","props","MonthInput","throwNotImplementedPlugin","Error","DateInputBase","fmt","createFormatter","parser","createParser","numberParser","createNumberParser","placeholders","getDisplayNames","state","value","NEXT","PREV","myRefs","defaultValues","inputSizes","isInitialized","forEach","type","length","origDay","slice","getTime","setDate","aux","map","part","reduce","string","Math","min","setState","triggerOnChange","event","indexOf","key","next","move","focus","select","keyCode","setTimeout","preventDefault","Object","keys","every","direction","parts","reverse","filter","onChange","isValid","locale","self","handleChange","bind","handleKeyDown","handleKeyPress","propTypes","func","instanceOf"],"mappings":"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","file":"date-input.js","sourcesContent":["import React, {Component, PropTypes} from \"react\";\n\nconst separators = \"/.- \";\n\nconst LEFT = 37;\nconst UP = 38;\nconst RIGHT = 39;\nconst DOWN = 40;\n\nconst get = {\n  day: \"getDate\",\n  month: \"getMonth\",\n  year: \"getFullYear\"\n};\n\nconst set = {\n  day: \"setDate\",\n  month: \"setMonth\",\n  year: \"setFullYear\"\n};\n\nfunction noop() {}\n\nfunction lastDay(date) {\n  return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();\n}\n\nexport class DateInput extends Component {\n  render() {\n    return (\n      <DateInputBase {...this.props} style=\"date-short\" />\n    );\n  }\n}\n\nexport class MonthInput extends Component {\n  render() {\n    return (\n      <DateInputBase {...this.props} style=\"yM\" />\n    );\n  }\n}\n\nfunction throwNotImplementedPlugin() {\n  throw new Error(\n    \"Plugin your desired i18n library, e.g., import \\\"date-input/src/plugin-globalize\\\"\"\n  );\n}\n\nexport default class DateInputBase extends Component {\n  static createFormatter = throwNotImplementedPlugin;\n  static createParser = throwNotImplementedPlugin;\n  static createNumberParser = throwNotImplementedPlugin;\n  static getDisplayNames = throwNotImplementedPlugin;\n\n  static propTypes = {\n    locale: PropTypes.string,\n    onChange: PropTypes.func,\n    value: PropTypes.instanceOf(Date)\n  };\n\n  constructor(props) {\n    super(props);\n    this.fmt = DateInputBase.createFormatter(props);\n    this.parser = DateInputBase.createParser(props);\n    this.numberParser = DateInputBase.createNumberParser(props);\n    this.placeholders = DateInputBase.getDisplayNames(props);\n    this.state = {\n      date: props.value || new Date()\n    };\n\n    // TODO: Reverse on RTL locale.\n    this.NEXT = RIGHT;\n    this.PREV = LEFT;\n\n    this.myRefs = {};\n    this.defaultValues = {};\n    this.inputSizes = {};\n    this.isInitialized = {};\n    this.fmt(new Date(2016, 11, 28)).forEach(({type, value}) => {\n      this.defaultValues[type] = value;\n      this.inputSizes[type] = value.length;\n      this.isInitialized[type] = true;\n    });\n  }\n\n  handleChange(type) {\n    let origDay;\n    let {value} = this.myRefs[type];\n    let {date} = this.state;\n\n    // Special handling for backspacing zero-padded numbers, e.g., backspacing\n    // \"03\" becomes \"0\" that should actually be handled as \"\".\n    if (this.numberParser(value) === 0) {\n      value = \"\";\n    }\n    this.isInitialized[type] = !!value.length;\n\n    // Special handling for value whose type !== \"year\", pick last two digits.\n    // For example, \"030\" becomes \"30\".\n    //\n    // This is needed because some locales use zero-padded fields, therefore\n    // trying to enter \"30\" takes the following steps:\n    // - enter 3, value changes from \"\" to \"3\" and formatted becomes \"03\";\n    // - enter 0, value changes from \"03\" to \"030\" (sliced \"30\") and formatted\n    //   becomes \"30\". Note that it only works if sliced.\n    if (type !== \"year\") {\n      value = value.slice(-2);\n    }\n\n    // Special handling for type \"month\" and \"year\": handle day limit.\n    if (type === \"month\" || type === \"year\") {\n      date = new Date(date.getTime());\n      origDay = date.getDate();\n      date.setDate(1);\n    }\n\n    let aux = this.fmt(date).map(part => {\n      if (part.type === type) {\n        return {type, value};\n      }\n      return part;\n    }).reduce((string, part) => {\n      let {type, value} = part;\n      if (type === \"literal\") {\n        return string + value;\n      }\n      value = this.isInitialized[type] ? value : this.defaultValues[type];\n      return string + value;\n    }, \"\");\n    aux = this.parser(aux);\n\n    if (aux) {\n\n      // Special handling for type \"month\" and \"year\": handle day limit.\n      if (type === \"month\" || type === \"year\") {\n        aux.setDate(Math.min(origDay, lastDay(aux)));\n      }\n\n      this.setState({date: aux});\n      this.triggerOnChange(aux);\n    }\n  }\n\n  handleKeyPress(type, event) {\n    // If key is a separator, focus next element.\n    if (separators.indexOf(event.key) !== -1) {\n      let next = this.move(type, \"next\");\n      if (next) {\n        this.myRefs[next.type].focus();\n        this.myRefs[next.type].select();\n      }\n    }\n  }\n\n  handleKeyDown(type, event) {\n    if (event.keyCode === this.NEXT || event.keyCode === this.PREV) {\n      let next = this.move(type, event.keyCode === this.NEXT ? \"next\" : \"prev\");\n      if (next) {\n        setTimeout(() => {\n          this.myRefs[next.type].focus();\n          this.myRefs[next.type].select();\n        });\n      }\n    } else if (event.keyCode === UP || event.keyCode === DOWN) {\n      let origDay;\n      let date = new Date(this.state.date.getTime());\n      event.preventDefault();\n      if (type === \"month\" || type === \"year\") {\n        origDay = date.getDate();\n        date.setDate(1);\n      }\n      date[set[type]](+ date[get[type]]() + (event.keyCode === UP ? 1 : -1));\n      if (type === \"month\" || type === \"year\") {\n        date.setDate(Math.min(origDay, lastDay(date)));\n      }\n      this.setState({date});\n      this.triggerOnChange(date);\n    }\n  }\n\n  isValid() {\n    return Object.keys(this.isInitialized)\n      .map(type => this.isInitialized[type])\n      .every(value => value === true);\n  }\n\n  move(type, direction) {\n    let aux;\n    let parts = this.fmt(this.state.date);\n    if (direction === \"prev\") {\n      parts = parts.reverse();\n    }\n    return parts.filter(part => {\n      if (aux && part.type !== \"literal\") {\n        aux = false;\n        return true;\n      }\n      if (part.type === type) {\n        aux = true;\n      }\n      return false;\n    })[0];\n  }\n\n  triggerOnChange(date) {\n    const {onChange = noop} = this.props;\n    if (!this.isValid()) {\n      onChange(null);\n      return;\n    }\n    onChange(date);\n  }\n\n  render() {\n    const parts = this.fmt(this.state.date);\n\n    return (\n      <div lang={this.props.locale}>\n        {parts.map(part => {\n          let {type, value} = part;\n          if (type === \"literal\") {\n            return (\n              <span>{value}</span>\n            );\n          }\n          value = this.isInitialized[type] ? value : \"\";\n          return (\n            <input\n              ref={self => this.myRefs[type] = self}\n              name={type}\n              value={value}\n              onChange={this.handleChange.bind(this, type)}\n              onKeyDown={this.handleKeyDown.bind(this, type)}\n              onKeyPress={this.handleKeyPress.bind(this, type)}\n              placeholder={this.placeholders[type]}\n              size={this.inputSizes[type]}\n            />\n          );\n        })}\n      </div>\n    );\n  }\n}\n"]}